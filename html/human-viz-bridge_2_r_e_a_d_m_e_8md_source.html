<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Human Dynamics Estimation: /home/travis/build/robotology/human-dynamics-estimation/human-viz-bridge/README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Human Dynamics Estimation
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">/home/travis/build/robotology/human-dynamics-estimation/human-viz-bridge/README.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="human-viz-bridge_2_r_e_a_d_m_e_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">## Tools for interfacing HDE module architecture with ROS RViz.</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;In order to visualize but also to assess the results of the HDE module architecture, some YARP modules that take as input Xsens system, human state, and human dynamics data and publish them in the form of ros topics (so as to be read from Rviz) have been implemented.</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Information about RViz can be found here: [http:<span class="comment">//wiki.ros.org/rviz](http://wiki.ros.org/rviz).</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;Information about how <span class="keyword">using</span> yarp with ROS can be found here: [yarp with ROS](http:<span class="comment">//www.yarp.it/yarp_with_ros.html).</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;The I/O scheme of these modules is the following:</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;&lt;img src=<span class="stringliteral">&quot;/misc/human-viz-bridge.png&quot;</span>&gt;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;Each module is described in detail below.</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;- **<a class="code" href="class_human_t_f_bridge.html">HumanTFBridge</a>** is the module in charge of reading from the Xsens system YARP <span class="keyword">interface </span>data regarding the position and the orientation in the global reference frame of each human segment and publishing them in the form of ros topic. </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;The workflow is the following:</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    - the urdf model of the human is loaded and a publisher to the topic &quot;/tf&quot; is opened;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    - since the urdf model we use includes &quot;real&quot; and &quot;fake&quot; segments to deal with joints characterised by more degreees of freedom, a list of the &quot;real&quot; segments is read from the module configuration file and put in a vector; then, comparing the list of all the segments taken from the urdf with the former list also a vector of the &quot;fake&quot; segments is created;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    - a class <a class="code" href="classtf2__msgs___t_f_message.html">tf2_msgs_TFMessage</a> compatible with ROS is created containing the coordinate frame transforms for each segment of the urdf model;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    - for the fake segments the class is filled with an identity transform since these segments are not visible in RViz while for the real segments is filled with data coming from the Xsens system YARP interface. These transforms are updated by means of a callback on a class BufferedPort &lt; XsensSegmentsFrame &gt; of the Xsens data and then published by means of a Publisher &lt; tf2_msgs_TFMessage &gt; class.</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;NB: the module period is set to 100 seconds since the data updating is controlled by the callback.</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;- **HumanJointStateBridge** is the module in charge of reading from the human-state-provider module data regarding the state of the human in the form of joints angles and the transform between the human base link and the global reference frame and publishing them in the form of ros topic. </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;The workflow is the following:</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    - the urdf model of the human is loaded and publishers to the topic &quot;/tf&quot; and to the topic &quot;/joint_state&quot; are opened;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    - the list of the joints is read both from the module configuration file and from the urdf model and then the two list are compared to check possible mismatches; then, a vector containing all joints is created; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    - a class <a class="code" href="classtf2__msgs___t_f_message.html">tf2_msgs_TFMessage</a> compatible with ROS is created containing the transform between the base link and the global reference frame; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    - a class sensor_msgs_jointState compatible with ROS is creted containing the state of each joint of the urdf model;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    - these class are filled with data coming from human-state-provider and updated by means of a callback on a class BufferedPort &lt; HumanState &gt; of the human state data and then published by means of a Publisher &lt; tf2_msgs_TFMessage &gt; class and a Publisher &lt; sensor_msgs_jointState &gt; class.</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  NB: the module period is set to 100 seconds since the data updating is controlled by the callback.</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;- **HumanEffortBridge** is the module in charge of reading from the human-dynamics-estimator module data regarding the dynamics of the human in the form of joint torques and publishing them in the form of ros topic.</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;The workflow is the following:</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    - the urdf model of the human is loaded and multiple publishers to the topic &quot;/&lt; JointName &gt;&quot; are opened;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    - the list of the joints whose efforts the user wants to display and the list of the relative links are read from the module configuration file while the list of all the joints is read from the urdf model;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    - multiple classes <a class="code" href="classsensor__msgs___temperature.html">sensor_msgs_Temperature</a> compatible with ROS are created containing all the joints torques the user wants to display;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    - these classes are filled with data coming from human-dynamics-estimator and updated by means of a callback on a class BufferedPort &lt; HumanDynamics &gt; of the human dynamics data and then published by means of multiple Publisher &lt; sensor_msgs_Temperature &gt; classes. For each &quot;real&quot; joint, the joints torques on each  degree of freedom of such &quot;real&quot; joint are summed together.</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  NB: the module period is set to 100 seconds since the data updating is controlled by the callback. </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;- **<a class="code" href="class_robot_base_pose_publisher.html">RobotBasePosePublisher</a>** is the module in charge of reading the human-state-provider data regarding the transform between the human base link and the global reference frame and the robot state, and then, publishing the transform between the robot base link and the global reference frame on their basis.</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;The workflow is the following:</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    - the list of the robot joints is read from the module configuration file and the urdf model of the robot is loaded;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    - a publisher to the topic &quot;/tf&quot; is opened;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    - in the configuration section of the module the transform between the human base link and the global reference frame is set to an identity transform, the transform between the robot kinematic frame and the human base link is read from configuration file and the transform; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    - in the updating section even the transform between the robot base link and the robot kinematic frame is computed and the final transformation between the robot base link and the global reference frame as a product of the former transforms is computed. Each time the user use the command &quot;setRobotPose&quot; the transform between the human base link and the global reference frame is updated and thus the final transform.</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;NB: In the **<a class="code" href="class_human_t_f_bridge.html">HumanTFBridge</a>** and in the **HumanJointStateBridge** modules when the ros topics are opened a prefix is added in order to display simultaneously in Rviz the same urdf model.</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">## How to use these modules with RViz</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;- Make sure you have ROS installed on your computer.</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;- if you do not have a workspace for catkin, create one following the [tutorial] (http:<span class="comment">//wiki.ros.org/catkin/Tutorials/create_a_workspace) in ros documentation;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;- [on Terminal 1] move to the src folder in the catkin workspace you have created and create a ros package with the following dependencies: </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;```</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;catkin_create_pkg &lt;package_name&gt; catkin roscpp rospy message_generation std_msgs geometry_msgs sensor_msgs tf urdf </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;```</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;- Move to the catkin_ws folder and run catkin_make:</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;```</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;cd ~/catkin_ws</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;catkin_make</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;```</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;- [on Terminal 2] launch `roscore`</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;- [on Terminal 3] launch rviz:</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;```</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;rosrun rviz rviz</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;```</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;- In order to launch urdf models, possible related publishers and rviz itself, copy the launch files and the human-viz-bridge.rviz in the ros package you have created and use this command (each time for each launch file in a different terminal):</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;```</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;roslaunch &lt;ros_package&gt; &lt;displayFiles.launch&gt;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;```</div>
<div class="ttc" id="class_human_t_f_bridge_html"><div class="ttname"><a href="class_human_t_f_bridge.html">HumanTFBridge</a></div><div class="ttdef"><b>Definition:</b> <a href="_human_t_f_bridge_8cpp_source.html#l00065">HumanTFBridge.cpp:65</a></div></div>
<div class="ttc" id="class_robot_base_pose_publisher_html"><div class="ttname"><a href="class_robot_base_pose_publisher.html">RobotBasePosePublisher</a></div><div class="ttdef"><b>Definition:</b> <a href="_robot_base_pose_publisher_8cpp_source.html#l00125">RobotBasePosePublisher.cpp:125</a></div></div>
<div class="ttc" id="classsensor__msgs___temperature_html"><div class="ttname"><a href="classsensor__msgs___temperature.html">sensor_msgs_Temperature</a></div><div class="ttdef"><b>Definition:</b> <a href="__yarp__idl___2msgs_2sensor__msgs___temperature_8h_source.html#l00025">sensor_msgs_Temperature.h:25</a></div></div>
<div class="ttc" id="classtf2__msgs___t_f_message_html"><div class="ttname"><a href="classtf2__msgs___t_f_message.html">tf2_msgs_TFMessage</a></div><div class="ttdef"><b>Definition:</b> <a href="__yarp__idl___2msgs_2tf2__msgs___t_f_message_8h_source.html#l00022">tf2_msgs_TFMessage.h:22</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
